<template>
    <div style="margin-right: 500px;">
      <div>
        <h5 style="margin-left: 630px;">Register</h5>
        <v-sheet>
          <v-form @submit.prevent="register">
            <div v-if="message" style="color: red;">{{ message }}</div>
  
            <v-text-field v-model="username" label="Username" type="username" outlined dense required></v-text-field>
            <v-text-field v-model="password" label="Password" type="password" outlined dense required></v-text-field>
            <v-text-field v-model="passwordConfirm" label="Password Confirm" type="password" outlined dense required></v-text-field>
  
            <v-btn type="submit" block class="mt-2" color="#000000">Submit</v-btn>
            <router-link to="/" style="color: #FFFFCC;" class="d-block text-center mt-2">Login</router-link>
          </v-form>
        </v-sheet>
      </div>
    </div>
  </template>
  
  <script>
  import router from '@/router';
  import axios from 'axios';
  
  export default {
    data() {
      return {
        username: '',
        password: '',
        passwordConfirm: '',
        message: '', // Initially, no message
      };
    },
    methods: {
      async register() {
        this.message = ''; // Resetting message before each form submission
  
        if (!this.username || !this.password || !this.passwordConfirm) {
          this.message = 'Please fill in all fields';
          return;
        }
  
        // Validate password complexity
        const letterNumberRegex = /^(?=.*[a-zA-Z])(?=.*[0-9])/;
        if (this.password.length < 10 || !letterNumberRegex.test(this.password)) {
          this.message = 'Password must be at least 10 characters long and contain both letters and numbers.';
          return;
        }
  
        if (this.password !== this.passwordConfirm) {
          this.message = 'Password do not match';
          return;
        }
  
        try {
          const data = await axios.post('api/register', {
            username: this.username,
            password: this.password,
          });
  
          if (data.data.msg === 'okay') {
            alert('Registered successfully');
            router.push('/');
          } else {
            this.message = data.data.msg || 'Invalid response';
          }
        } catch (error) {
          console.error('Error:', error);
          this.message = 'Error occurred while registering';
        }
      },
    },
  };
  </script>
  